<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>X11workbench Toolkit: X11workbench Toolkit Coding Style Guidelines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">X11workbench Toolkit
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mainpage_style.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">X11workbench Toolkit Coding Style Guidelines </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>CODE</b> <b>APPEARANCE</b> </p>
<p><b>Coding</b> <b>Style</b> for this project uses <b>Allman</b> <b>Style</b> indenting, NO hard tab characters, and with 2 (two) spaces per indent. See <a href="http://en.wikipedia.org/wiki/Indent_style#Allman_style">http://en.wikipedia.org/wiki/Indent_style#Allman_style</a></p>
<p>On FreeBSD, you can rapidly convert 'less readable' code to the 'improved' (and approved) style using the following command:</p>
<div class="fragment"><div class="line">indent -bl -ncdb -nce -ci3 -cli1 -c1 -d0 -di1 -dj -nfc1 -nfcb -i2 -l255 -lp -npsl -nsc -nut filename.c</div></div><!-- fragment --><p>With the exception of macros, ALL conditional and loop commands (if, for, while) must be on a line SEPARATE from the opening curly brace, and ALL of them should have curly braces around the conditional or loop body (particularly for a single line of executed code). The only exception would be a 'for' or 'while' loop that has no body, which can have '{ }' following the 'for' or 'while' to visually indicate that there is no loop body.<br />
 The purpose for this rule is twofold: First, it is not (easily) possible to set a breakpoint on a conditional statement that is on the same line as an 'if', or within a loop if it is on the same line as a 'for' or 'while'. Second, the code is a LOT more readable when extra line feeds are thrown in, even though it means you have an 'otherwise blank' line. If you are THAT concerned about vertical white space, use it by putting a comment after the '{' or '}'.</p>
<p>White space between 'if' 'for' 'while' and the leading paranthesis '(' is discouraged. The same is true for function calls and function definitions. It does not really add to the readability. Multiple lines properly indented, however, CAN make things more readable.<br />
 'else' is NEVER on the same line as '{' or '}'. NEVER. Not negotiable. 'else if' is OK.<br />
 But NEVER should '} else {' EVER exist ANYWHERE in this code base. It's just plain UGLY.<br />
 And for what it's worth, 'if (conditional) {' is nearly as bad. Put the '{' on its OWN line, as I pointed out above.</p>
<p>When the line length of a single code statement exceeds the typical width of an editor (80 to 100 columns), you should split it onto multiple lines. Indentation of the lines should follow a reasonable method that helps you to 'visually group' things. Here are a few examples:<br />
</p><div class="fragment"><div class="line"><span class="keywordflow">for</span>(i1=0,p1=buffer,pEnd=buffer + <span class="keyword">sizeof</span>(buffer);</div><div class="line">    p1 &lt; pEnd;</div><div class="line">    p1++, i1++)</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>(p1 &amp;&amp;</div><div class="line">   ((*p1 == <span class="charliteral">&#39;\&#39;&#39;</span> &amp;&amp; (!p1[1] || p1[1] == <span class="charliteral">&#39;\&#39;&#39;</span>)) ||</div><div class="line">    (*p1 == <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; (!p1[1] || p1[1] == <span class="charliteral">&#39;&quot;&#39;</span>))))</div><div class="line">{</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><p><b>SECURITY</b> <b>AND</b> <b>PERFORMANCE</b> </p>
<p>Avoid ANY possibility of buffer overruns. Use 'fgets' and not 'gets', do parameter checking and parse 'the hard way' instead of using scanf or sscanf for string parameters, etc.<br />
 If 'proof of concept' or 'under development' code temporarily uses 'the wrong method', mark the code with a 'TODO' comment to indicate that it needs to be re-factored for reliability.</p>
<p>Avoid excessive use of allocated memory. If you need a lot of small memory blocks, create a structure instead, and allocate THAT way. If the structure has an array in it, the array should be the final member of the structure, declared with a single element, and the actual size of the structure should be large enough to accomodate the entire array. There are already a lot of examples of dynamically sized array structures within the code that behave this way.<br />
 In cases where an object may be accessed by a worker thread after the main thread has destroyed it, you should use reference counting to prevent accessing 'free'd memory blocks.</p>
<p>There is a set of generic platform-independent sub-allocation utilities, <a class="el" href="group__sub__alloc.html#ga8ee962cea8e2f0cb52d1cab9057ffe6c" title="High performance memory sub-allocator &#39;allocate&#39;. ">WBAlloc()</a>, <a class="el" href="group__sub__alloc.html#gaf2228924f510dc4b6f6b86b44c0e4e11" title="High performance memory sub-allocator &#39;re-allocate&#39;. ">WBReAlloc()</a> and <a class="el" href="group__sub__alloc.html#gaebf9d7c0cd9aa525a93d0c5cc5376a1c" title="High performance memory sub-allocator &#39;free&#39;. ">WBFree()</a>. In those cases where you really DO need to allocate a lot of dynamic memory blocks, use these functions in lieu of 'malloc()' 'realloc()' or 'free()'. Contributed code should not abuse these functions, but INSTEAD make use of them ONLY when actually needed, and get cleaned up properly. There should NEVER be any 'use after free' or 'memory leak' problems in the toolkit or in the X11 Workbench.</p>
<p>Preventing 'use after free' can be a simple discipline of assigning any pointer to NULL right after calling <a class="el" href="group__sub__alloc.html#gaebf9d7c0cd9aa525a93d0c5cc5376a1c" title="High performance memory sub-allocator &#39;free&#39;. ">WBFree()</a>, even if there is no code that might use the pointer (for now, at least). Code that might be added later by others may attempt to use this pointer, assuming it is valid. Assigning it to NULL is therefore pre-emptive in this case, forcing a crash to occur instead of pointer re-use, which is FAR more preferable, as it would likely be caught early on.</p>
<p>All functions must be declared in the form of 'a prototype', as per ANSI standards. Functions without any arguments must have '(void)' rather than '()'. All function return types are to be declared (no assumptions), and inline functions MUST be declared 'static', especially in header files.<br />
 Declaring no-parameter functions with a prototype or using '(void)' for the parameter list, will work around those casees where a function is declared earlier in the code, without an actual prototype, and you get a warning that it is "not a prototype".</p>
<p>You should do a test-build of the code on multiple platforms, both debug and release, and eliminate all compile warnings. In some cases a warning will be generated on a 32-bit system but not on a 64-bit system (or vice versa). In other cases a warning may be generated by a compiler on one operating system but not another. Building on multiple platforms helps to address this.</p>
<p><b>OBJECTS</b> <b>AND</b> <b>SHARED</b> <b>DATA</b> </p>
<p>C language code can be 'object oriented' too, if designed properly, by using object-oriented principles in the design and use of structures as 'objects'. Several structures are already being abstracted to 'hide' members that are for internal use only, and others have function 'vtable' structures associated with them. If you create a persistent structure that is to be shared or abstracted, you should have a 'Constructor' API function and a corresponding 'Destroy' API function (as needed).<br />
 For shared objects, particularly those that may be used simultaneously by different threads, you should have thread-safe entry/exit code (as needed) and some form of reference counting, such as 'AddRef/Release' functions, in which 'the final Release' will actually destroy the object. This is similar to the object reference count handling done by both CORBA and OLE 2.0<br />
 <b>CODE</b> <b>COMMENTS</b> <b>AND</b> <b>NAMING</b> <b>CONVENTIONS</b> </p>
<p>Code comments are always welcome. Unless the comments are trivial, there is no such thing as "too many comments", and even trivial ones might be welcome at times. Single-line comments are preferred except for '#define', unless you need a commented area to 'stand out' more.<br />
 API functions and structures must have minimal doxygen comments describing the functions, parameters, and structure members. They should also be members of functional groups. No exceptions. You should also test the resulting documentation to make sure it's properly formatted and that all of the links work correctly.</p>
<p>Code should be as self-documenting as possible. Non-trivial variables should be declared using descriptive names. Hungarian notation can be helpful, but is not required. Single-character variable names are DIFFICULT TO CHANGE without manual effort and should be AVOIDED, ALWAYS!<br />
 Use of non-descriptive variables such as 'i1' or 'p3' is ok so long as its usage is intuitively obvious within the code. If any confusion might arise from a casual observer, use more descriptive variable names. Common sense should be the rule here.</p>
<p>'CamelHump' names should capitalize in a manner that helps understand where the word divisions are. Similarly, underscores can be used for 'all_lower_case' names for the same purpose. Generally, API functions are 'CamelHump', utilities and trivial functions are 'all_lower_case', '#define's are ALL_CAPS, and enumerations are prefixed with the enumeration name. API functions should also begin with something that identifies the subsystem, such as 'WB' or 'FW' or 'Dlg'. This is NOT a 'hard' rule, but it DOES help minimize confusion and name collisions.<br />
 It is also typical to prefix '_' or '__' on alias names or internal-use functions. Such names and functions should not be publically used except as part of a typedef. Example, a structure name of '<em>my_struct</em>' typedef'd as MY_STRUCT. Members of 'MY_STRUCT' (such as linked list pointers) are likely to refer to the structure name itself, and not the typedef name, so both names are needed.</p>
<p>'Magic numbers' are a necessary evil sometimes. Either document where the number came from, or use a '#define' with a descriptive name, or use BOTH. A '#define' placed in the code within a function is acceptable as long as it's only used within that function.<br />
 <b>GOOD</b> <b>AND</b> <b>BAD</b> <b>CODE</b> <b>EXAMPLES:</b> </p>
<div class="fragment"><div class="line"><span class="comment">// ----------</span></div><div class="line"><span class="comment">// -- GOOD --</span></div><div class="line"><span class="comment">// ----------</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MY_BUFFER_SIZE 256</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> i1;</div><div class="line">  <span class="keywordtype">char</span> buffer[MY_BUFFER_SIZE];</div><div class="line"></div><div class="line">  <span class="comment">// use of &#39;fgets&#39; with specific buffer size</span></div><div class="line">  <span class="comment">// no danger of buffer overflow this way</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span>(fgets(buffer, <span class="keyword">sizeof</span>(buffer), stdin))</div><div class="line">  {</div><div class="line">    i1 = strlen(buffer);</div><div class="line"></div><div class="line">    fprintf(stdout, <span class="stringliteral">&quot;Hello World %d\n&quot;</span>, i1);</div><div class="line">    <span class="comment">// using fprintf rather than printf, but specifying &#39;stdout&#39;</span></div><div class="line">    <span class="comment">// If need be, it can be easily re-directed to a different file</span></div><div class="line">    <span class="comment">// it also clarifies that output will be to &#39;stdout&#39;.</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0; <span class="comment">// standard &#39;success&#39; return value of zero</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="comment">// proper error/exception handling</span></div><div class="line">  {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;fgets returned NULL\n&quot;</span>);</div><div class="line">    <span class="comment">// error messages to &#39;stderr&#39;</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 1; <span class="comment">// return an error code</span></div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ---------</span></div><div class="line"><span class="comment">// -- BAD --</span></div><div class="line"><span class="comment">// ---------</span></div><div class="line"></div><div class="line">main() {</div><div class="line">  <span class="comment">// ugly &#39;{&#39; on same line as function - this is supposed to be ANSI C, and NOT K&amp;R nor PASCAL!</span></div><div class="line">  <span class="comment">// function parameters missing, should be (void) or properly declared, even if unused</span></div><div class="line">  <span class="comment">// missing return type on &#39;main&#39; (int assumed, don&#39;t rely on it!)</span></div><div class="line"></div><div class="line">  <span class="keywordtype">int</span> a;           <span class="comment">// single-character name, no indication of type from the name</span></div><div class="line">  <span class="keywordtype">char</span> b[256];     <span class="comment">// single-character name, &#39;magic number&#39; buffer size</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (gets(b)) a = strlen(b);    <span class="comment">// &#39;if&#39; on same line as conditional code (can&#39;t set debug breakpoint!)</span></div><div class="line">                                 <span class="comment">// &#39;gets&#39; has no buffer size checking, buffer overrun possible</span></div><div class="line">                                 <span class="comment">// no &#39;{&#39; &#39;}&#39; around the conditional code block (bad style)</span></div><div class="line"></div><div class="line">  printf (<span class="stringliteral">&quot;Hello, World %d\n&quot;</span>, a); <span class="comment">// use of &#39;printf&#39; discouraged; &#39;fprintf&#39; with &#39;stdout&#39; or &#39;stderr&#39;</span></div><div class="line">                                   <span class="comment">// is preferred.  Use stderr for messages unless it&#39;s &quot;the actual output&quot;</span></div><div class="line"></div><div class="line">  <span class="comment">// sloppy error handling (&#39;a&#39; may be un-initialized)</span></div><div class="line"></div><div class="line">  <span class="comment">// no return value specified</span></div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jun 7 2019 03:54:33 for X11workbench Toolkit by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
